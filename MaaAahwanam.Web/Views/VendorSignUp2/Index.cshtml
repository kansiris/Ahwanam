@model MaaAahwanam.Models.VendorImage
@{
    ViewBag.Title = ":: Upload Photos ::";
    Layout = "~/Views/SharedWeb/VendorMasterPage.cshtml";
    var i = 0;
}


<div class="container border-default">
    <div class="row">
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 margin-top">
            <h4>Create a Free Ahwanam account</h4>
        </div>
    </div>
    <div class="row progress-area text-center">
        <div class="progress-ui">
            <div class="complete"><span>1</span></div>
            <div class="complete"><span>2</span></div>
            <div><span>3</span></div>
            <div><span>4</span></div>
        </div>
        <div class="progress-content">
            <div>General Information</div>
            <div>Photo Gallery</div>
            <div>Frequently Asked Questions</div>
            <div>Promotions</div>
        </div>
    </div>
    <form method="post" enctype="multipart/form-data" id="uploadimageform">
        <div class="block">
            <div class="row">
                <div class="col-xs-12 col-sm-12 col-md-12 form-headding border-default-top border-default-bottom">
                    <h4><i class="fa fa-picture-o" aria-hidden="true"></i> Photo Gallery</h4>
                    <input type="hidden" id="ImageType" name="ImageType" />
                    <input type="hidden" id="Imagedescription" name="Imagedescription" />
                </div>
            </div>
            <div class="row margin-top margin-bottom">
                <div class="col-xs-10 col-sm-10 col-md-10 margin-left margin-right padding-top-10 light-sky-blue-bg">
                    <p class="grey">
                        <small>8 photos are required</small><br>
                        <b>Showcase your work by adding high-quality photos of your business and the wedding services or products you offer.</b>
                    </p>
                </div>
            </div>
            <div class="row margin-top margin-bottom">
                <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                    <p class="font-size-14"> <i class="fa fa-thumbs-up red padding-right-10" aria-hidden="true"></i>You must add a minimum of one logo and 8 photos </p>
                    <p class="font-size-14 bold"> <i class="fa fa-thumbs-up red padding-right-10" aria-hidden="true"></i>Click and drag images to reorder them </p>
                </div>
            </div>
        </div>
        <div class="block">
            <div class="row margin-bottom">
                <div class="col-xs-12 col-sm-12 col-md-8 col-lg-8 col-md-offset-2 col-lg-offset-2 text-center upload-file padding-top-10 padding-bottom-10">
                    <h4 class="grey">Select Below</h4>
                    @*<input type="file" class="opacity-0">*@
                    @*<input type="file" multiple="multiple" accept="image/*" id='fileUpload1' name="file" class="opacity-0">*@
                    @*<button type="button" class="btn btn-default red-bg white" onclick="javascript: document.getElementById('fileUpload1').click();">Click Here</button>
                        <input type='file' multiple="multiple" accept="image/*" id='fileUpload' name="file" style="display:none"/>*@
                    <button type="button" class="btn btn-default red-bg white" onclick="javascript: document.getElementById('fileUpload1').click();">Click Here</button>
                    <input type="file" multiple="multiple" accept="image/*" id='fileUpload1' name="file" style="display:none">
                    <input type="hidden" id="removedimages" name="removedimages" />
                </div>
            </div>
        </div>
        <!-- The global progress bar -->
        <!-- The global progress state -->
        <div class="col-lg-5 fileupload-progress fade">
            <!-- The global progress bar -->
            <div class="progress progress-striped active" role="progressbar" aria-valuemin="0" aria-valuemax="100">
                <div class="progress-bar progress-bar-success" style="width:0%;"></div>
            </div>
            <!-- The extended global progress state -->
            <div class="progress-extended">&nbsp;</div>
        </div>
        <table role="presentation" class="table table-striped"><tbody class="files"></tbody></table>
        <div class="block margin-top-30">
            <h2 id="uploadimagediv" style="display:none">Uploaded images</h2>
            <div class="row margin-top margin-bottom" id="dvPreview"></div>
        </div>
        @if (ViewBag.images.Count != 0)
        {
            <div class="block margin-top-30">
                <h2>Database images</h2>
                <div class="row margin-top margin-bottom" id="dbPreview">
                    @foreach (var item in ViewBag.images)
                    {
                        <div class='col-xs-6 col-sm-4 col-md-2 col-lg-2 blocks'>
                            <div class='block thumbnail'>
                                <div class='ow thumb-img'>
                                    <img src="~/vendorimages/@item.ImageName" style="height:120px;width:120px" alt="@item.ImageName" />
                                </div>
                                <div class='row margin-top'>
                                    <div class='form-group-1 col-xs-12 col-sm-12 col-md-12'>
                                        <input type='text' class='form-control' placeholder='Description:' required value="@item.Imagedescription" id="Imagedescription" name="Imagedescription" onblur="updaterecord()">
                                    </div>
                                </div>
                                <div class='row'>
                                    <div class='col-xs-12'>
                                        <div class='radio'>
                                            @if (item.ImageType == "Logo")
                                            {
                                                <label><input type='radio' name='optradio+@i' value="Logo" checked><span></span>Logo</label>
                                            }
                                            else
                                            {
                                                <label><input type='radio' name='optradio+@i' value="Logo"><span></span>Logo</label>
                                            }
                                        </div>
                                        <div class='radio'>
                                            @if (item.ImageType == "Photo")
                                            {
                                                <label><input type='radio' name='optradio+@i' value="Photo" checked><span></span>Photo</label>
                                            }
                                            else
                                            {
                                                <label><input type='radio' name='optradio+@i' value="Photo"><span></span>Photo</label>
                                            }
                                        </div>
                                    </div>
                                </div>
                                <div class='hr-line border-default-bottom'></div>
                                <div class='row'>
                                    <div class='col-xs-12 col-md-12'>
                                        <a href="/VendorSignUp2/Removeimage?src=@item.ImageName&&id=@ViewBag.id&&vid=@ViewBag.vid&&type=@Request.QueryString["type"]">
                                            <p class='red'>
                                                <small>
                                                    <i class='fa fa-times padding-right-5 grey' aria-hidden='true'></i>Remove Photo
                                                </small>
                                            </p>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <p style="display:none">@(++i)</p>
                    }
                </div>
            </div>
        }
        <div class="col-xs-12 col-sm-12 col-md-12 padding-left-0 padding-right-0 border-default-bottom hr-line"></div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                @*<a href="/VendorSignUp3" class="btn btn-default red-bg white">Next</a>*@
                @if (ViewBag.images.Count != 0)
                {
                    <input type="submit" value="Save" class="btn btn-default red-bg white margin-left" id="uploadBtn" name="command" disabled/>
                    <input type="submit" value="Update" class="btn btn-default red-bg white margin-left" id="updaterecord" name="command" />
                }
                else
                {
                    <input type="submit" value="Save" class="btn btn-default red-bg white margin-left" id="uploadBtn" name="command" />
                    <input type="submit" value="Update" class="btn btn-default red-bg white margin-left" id="updaterecord" name="command" disabled/>
                }
                @*<input type="submit" value="Save" class="btn btn-default red-bg white margin-left" id="uploadBtn" name="command" />
                <input type="submit" value="Update" class="btn btn-default red-bg white margin-left" id="updaterecord" name="command" />*@
                <a href="/availableservices?id=@ViewBag.id&&vid=@ViewBag.vid" class="btn btn-default red-bg white margin-left">Cancel</a>
            </div>
            <div class="blockDescrption" style="display:none"></div>
            <div class="radioName" style="display:none"></div>
        </div>
    </form>
</div>
<script type="text/javascript" src="~/newdesign/js/jquery-3.2.1.min.js"></script>
<script type="text/javascript" src="~/newdesign/js/bootstrap.js"></script>

<script>
    $(document).on('change', '#fileUpload1', function () {
        var filecount = $(this)[0].files.length;
        if (filecount <= 8) {
            //$("#fileUpload1").change(function () {
            if (typeof (FileReader) != "undefined") {
                var dvPreview = $("#dvPreview");
                //var no = 1;
                //dvPreview.html("");
                var regex = /^([a-zA-Z0-9\s_\\.\-:])+(.jpg|.jpeg|.gif|.png|.bmp)$/;
                var i = 0;
                $($(this)[0].files).each(function () {
                    var file = $(this);
                    if (regex.test(file[0].name.toLowerCase())) {
                        var reader = new FileReader();
                        reader.onload = function (e) {
                            var img = $("<img />");
                            img.attr("style", "height:90px;width:90px");
                            img.attr("src", e.target.result);
                            img.addClass();
                            //dvPreview.append(img);
                            dvPreview.prepend("<div class='col-xs-6 col-sm-4 col-md-2 col-lg-2 blocks'><div class='block thumbnail'><div class='row thumb-img'><img style='height:120px;width:120px' src=" + e.target.result + " alt = " + file[0].name + "></img></div><div class='row margin-top'><div class='form-group-1 col-xs-12 col-sm-12 col-md-12'><input type='text' class='form-control' placeholder='Description:' required></div></div><div class='row'><div class='col-xs-12'><div class='radio'><label><input type='radio' name='optradio" + i + "' required value='Logo'>Logo<span></span></label></div><div class='radio'><label><input type='radio' name='optradio" + i + "' required value='Photo'>Photo<span></span></label></div></div></div><div class='hr-line border-default-bottom'></div><div class='row'><div class='col-xs-12 col-md-12'><p class='red'><small><i class='fa fa-times padding-right-5 grey' aria-hidden='true'></i>Remove Photo</small></p></div></div></div></div>");
                            //dvPreview.prepend("<div class='col-xs-6 col-sm-4 col-md-2 col-lg-2 blocks'><div class='block thumbnail'><div class='row thumb-img'><img style='height:120px;width:120px' src=" + e.target.result + " alt = " + file[0].name + "></img></div><div class='row margin-top'><div class='form-group-1 col-xs-12 col-sm-12 col-md-12'><input type='text' class='form-control' placeholder='Description:' required></div></div><div class='row'><div class='col-xs-12'><div class='radio'><label><input type='radio' name='optradio" + i + "' requried>Logo<span></span></label></div><div class='radio'><label><input type='radio' name='optradio" + i + "' requried>Photo<span></span></label></div></div></div><div class='hr-line border-default-bottom'></div><div class='row'><div class='col-xs-12 col-md-12'><p class='red'><small><i class='fa fa-times padding-right-5 grey' aria-hidden='true'></i>Remove Photo</small></p></div></div></div></div>");
                            i++;
                        }
                        reader.readAsDataURL(file[0]);
                        $('#uploadimagediv').show();
                    } else {
                        alert(file[0].name + " is not a valid image file.");
                        //dvPreview.html("");
                        return false;
                    } //no++;
                    $('#uploadBtn').removeAttr('disabled');
                    $('#updaterecord').attr('disabled', 'disabled');
                    //document.getElementById("fileUpload1").value = "";
                });
            } else {
                alert("This browser does not support HTML5 FileReader.");
            }
            //});
        }
        else {
            alert("Max 6 Photos Allowed at a time");
        }
        //var v = $(this).parents("div.row").parents("div.thumbnail").find("div.thumb-img").children("img").attr('alt');
        //alert(v);
    });
    /*=============== Image Block remove =============*/
    $(document).on('click', 'p.red', function () {
        //$("p.red").click(function () {
        var removed;
        var x = $(this).parents(".blocks").css({ "transform": "translateX(1000px)", "opacity": "0" });
        setTimeout(function () { x.remove(); }, 200);
        var imgname = $(this).parents("div.row").parents("div.thumbnail").find("div.thumb-img").children("img").attr('alt');
        var value = $('#removedimages').val();
        if (value == "")
            removed = imgname;
        else
            removed = imgname + ',' + value;

        @*alert(imgname.replace('/vendorimages/', ''));
        alert(@ViewBag.id);
        alert(@ViewBag.vid)*@

        @*var id = '@Request.QueryString["id"]';
        var vid = '@Request.QueryString["vid"]';
        $.ajax({
            url: '/VendorSignUp2/Removeimage',//?src=' + imgname.replace('/vendorimages/', '')+'id='+id+'vid='+vid,
            type: 'POST',
            data: JSON.stringify({ src: imgname.replace('/vendorimages/', '') ,id : id,vid:vid}),
            dataType: 'json',
            contentType: 'application/json',
            success: function (data) {
                if (data == "success") {
                    alert('Image deleted successfully!');
                }
                else {
                    alert('Failed!');
                }
            },
            error: function (data)
            { errormsg("Failed!!!"); }
        });*@


        $('#removedimages').val(removed);
    });
    /*=============== Image Block remove =============*/

    /*=============== Blocks Radio name and Descrption save in hidden variable =============*/

    //$(document).on('click','div.radio:first-of-type',function(){
    $(document).find('#dvPreview .blocks div.radio').click(function () {
        //$(document).find('#dvPreview > .blocks > div.radio').on('click', function () {
        alert("hi");
        $(this).next("div.radio").find("input[type='radio']").prop('checked', false);
        $("#dvPreview .blocks div.radio:last-of-type input[type='radio']").each(function () {
            $(this).attr('checked', 'checked');
        });
    });

    $("#uploadBtn").click(function (e) {
        $('.radioName').empty();
        $('.blockDescrption').empty();
        e.preventDefault();
        var arr;
        var BlockLen = $("#dvPreview .blocks").length;
        $('div.radio').find('input[type="radio"]').each(function () {
            if ($(this).is(':checked')) {
                $(".radioName").append($(this).val() + ',');
            }
        });
        $("#dvPreview .blocks").find('input[type="text"]').each(function () {
            var v = $.trim($(this).val());
            if (v != "") {
                $(".blockDescrption").append($(this).val() + ',');
            }
        });
        $('#Imagedescription').val($('.blockDescrption').text().slice(0, -1));
        $('#ImageType').val($('.radioName').text().slice(0, -1));
        var url = window.location.href.replace(window.location.protocol + '//', '').replace(window.location.host + '/', '') + '&&command=Save';
        //alert(url);
        //var url = 'VendorSignUp2/Index?id=@Request.QueryString["id"]&vid=@Request.QueryString["vid"]&type=@Request.QueryString["type"]&command=Save';
        $("#uploadimageform").attr("action", url);
        this.form.submit();
    });


    /*=============== Blocks Radio name and Descrption save in hidden variable =============*/

    $("#updaterecord").click(function (e) {
        $('.radioName').empty();
        $('.blockDescrption').empty();
        e.preventDefault();
        var arr;
        var BlockLen = $("#dbPreview .blocks").length;
        $('div.radio').find('input[type="radio"]').each(function () {
            if ($(this).is(':checked')) {
                $(".radioName").append($(this).val() + ',');
            }
        });
        $("#dbPreview .blocks").find('input[type="text"]').each(function () {
            var v = $.trim($(this).val());
            if (v != "") {
                $(".blockDescrption").append($(this).val() + ',');
            }
        });
        $('#Imagedescription').val($('.blockDescrption').text().slice(0, -1));
        $('#ImageType').val($('.radioName').text().slice(0, -1));
        //var url = window.location.href.replace(window.location.protocol + '//', '').replace(window.location.host + '/', '') + '&&command=update';
        var url = 'VendorSignUp2/Index?id=@Request.QueryString["id"]&vid=@Request.QueryString["vid"]&type=@Request.QueryString["type"]&command=update';
        $("#uploadimageform").attr("action", url); //"/VendorSignUp2/index?command=update"
        this.form.submit();
    });

    $(document).on('load', function () {
        alert();
    });
</script>

