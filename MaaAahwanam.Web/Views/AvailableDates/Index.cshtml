@model MaaAahwanam.Models.Availabledates
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/SharedWeb/VendorMaster.cshtml";
}

<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta name="robots" content="noindex, nofollow">
    <meta name="googlebot" content="noindex, nofollow">
    <script type="text/javascript" src="//code.jquery.com/jquery-1.8.3.js"></script>
    @*<link rel="stylesheet" type="text/css" href="/css/result-light.css">*@
    @*<script type="text/javascript" src="http://saumurbikehire.com/booking/datetime/jquery.datetimepicker.js"></script>
    <link rel="stylesheet" type="text/css" href="http://saumurbikehire.com/booking/datetime/jquery.datetimepicker.css">*@
    <script src="http://multidatespickr.sourceforge.net/jquery-ui.multidatespicker.js"></script>
    <script src="http://code.jquery.com/ui/1.9.2/jquery-ui.js"></script>
    <link rel="stylesheet" href="http://code.jquery.com/ui/1.9.2/themes/base/jquery-ui.css" />
    <link href="~/CSSWeb/dates.css" rel="stylesheet" />
       
    <title></title>

    @*<script type='text/javascript'>
            $(function () {
                var setMinTime = "";
                var today = new Date();
                var lastDate = new Date(today.getFullYear(), today.getMonth(0) + 1, 31);
                $('#products_delivery').datetimepicker({
                    inline: true,
                    lang: 'en',
                    startDate: '-1m',
                    endDate: lastDate,
                    timepicker: false,
                    format: 'Y/m/d',
                    formatDate: 'Y/m/d',
                });
            });
        </script>*@
</head>

@section Navigation
{
    <div class="breads">
        <div class="breads_inner">
            <div class="pageWidth">
                <div class="title">
                    <h3>Invitation</h3>
                </div>
                <div class="breadcrumbs">
                    <ul>
                        <li><a href="../Index/index">Home</a></li>
                        <li><i class="breads_arrow"></i></li>
                        <li><a href="index.html">Services</a></li>
                        <li><i class="breads_arrow"></i></li>
                        <li>Invitation</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
}
<body>
    @using (Html.BeginForm("Index", "AvailableDates", FormMethod.Post, new { @class = "form-signin", @id = "register_form", @autocomplete = "off", @enctype = "multipart/form-data" }))
    {
        @*@Html.TextAreaFor(m => m.availabledate, new { @id = "products_delivery", @name = "products_delivery", @class = "some_class", required = "required" })*@

        <div id="products_delivery" align="center"></div>

        <br /><br />
        <div align="center">
            <button type="submit" name="command" value="save" class="btn btn-big btn-green">Save Date<i class="ti-angle-double-right"></i></button>
            <button type="submit" name="command" value="remove" class="btn btn-big btn-red">Remove Selected<i class="ti-trash"></i></button>
        </div>

        @Html.HiddenFor(m => m.availabledate, new { @style = "width: 500px;" })

        <input type="hidden" id="removedates" />
    }

    <script>
        $(function () {
            getdates();
        });

        var unavailableDates;
        function getdates() {
            $.ajax({
                type: "POST",
                url: "/AvailableDates/GetDates",
                data: '',
                success: function (data) {
                    debugger;
                    unavailableDates = data; var today = new Date();
                    //var firstDay = today.toLocaleDateString();
                    //alert(data);
                    $('#products_delivery').multiDatesPicker({
                        altField: '#availabledate', minDate:today, //minDate: '-1m', maxDate: '+1m',
                        dateFormat: 'dd/mm/yyyy', //addDisabledDates: [unavailableDates.split(',')],
                        beforeShowDay: function (date) {
                            var dmy = date.getDate() + "/" + (date.getMonth() + 1) + "/" + date.getFullYear(); 
                            debugger;
                            if ($.inArray(dmy, unavailableDates) == -1) {
                                return [true, ""];
                            } else {
                                return [false, "myclass", "Unavailable"];
                            }
                        }
                    });
                },
                dataType: "json",
                traditional: true
            });
        }
    </script>
    <script>
        $("body").on('click', ".ui-datepicker td.myclass > span", function () {
            var date = new Date();
            var today = new Date().getDate() + 1;
            var value = $(this).html();
            var removeddates = $('#removedates').val();
            var date = value + "/" + (date.getMonth() + 1) + "/" + date.getFullYear();
            if (value > today) {
                $(this).css('background', 'red');
                $('#removedates').val(date);
                appendWords(date);
            }
            
        });

        function appendWords(d) {
            var resultObj = $("#availabledate");
            var outputObj = $("#removedates");
            var stringToAppend = resultObj.val().length > 0 ? resultObj.val() + "," : "";
            resultObj.val(stringToAppend + outputObj.val());
            var appended = $("#availabledate").val();
        }
    </script>
</body>
</html>